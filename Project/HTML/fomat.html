<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
  </head>
  <body>
    <h2>Test WebSocket</h2>
    <button onclick="connect()">K·∫øt n·ªëi</button>
    <button onclick="send()">G·ª≠i y√™u c·∫ßu l·∫•y comment</button>
    <pre id="messages"></pre>

    <script>
      let stompClient = null;
      const token =
        "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiIxNiIsInNjb3BlIjoiQURNSU4gbnVsbCIsImlzcyI6IndlYnNpdGUuY29tIiwiZXhwIjoxNzUyODUwNTA2LCJpYXQiOjE3NTI4NDY5MDYsImp0aSI6ImU3Mjc0NDU3LTcwZGItNGYxNC1iZDljLWY3OGIxNDUzYTZlNSIsImVtYWlsIjoiYWRtaW5AYWRtaW4uY29tIn0.D9bGG47aAQyXY8s73RExnBPuTN_zmnXzS0qoknzoNTCIAVL0wVTYwSVDC-PuzFcqPTXQ5H2W3xGgOt8w3p74SA";
      const postId = 2;

      function connect() {
        const socket = new SockJS("http://localhost:8080/ws");
        stompClient = Stomp.over(socket);

        // G·ª≠i token trong header Authorization
        stompClient.connect(
          { Authorization: "Bearer " + token }, // üëà TH√äM D√íNG N√ÄY
          function (frame) {
            console.log("‚úÖ Connected: " + frame);

            // L·∫Øng nghe ph·∫£n h·ªìi t·ª´ server
            stompClient.subscribe("/user/queue/comments", function (message) {
              console.log("üì• Nh·∫≠n comment:", message.body);
              document.getElementById("messages").textContent = message.body;
            });

            // G·ª≠i y√™u c·∫ßu sau khi k·∫øt n·ªëi th√†nh c√¥ng
            send();
          },
          function (error) {
            console.error("‚ùå K·∫øt n·ªëi th·∫•t b·∫°i:", error);
          }
        );
      }

      function send() {
        stompClient.send(`/app/comments.fetchAll/${postId}`, {}, token);
      }
    </script>
  </body>
</html>
